{% extends 'base-front.html.twig' %}

{% block title %}Détails de la Tâche{% endblock %}


{% block body %}
<div class="container mt-4">
	<div class="row">
		<div class="col-md-6">
			<div class="card mb-3">
				<div class="card-body">
					<h5 class="card-title text-primary">Catégorie</h5>
					<p class="card-text">
						<h6>{{ tache.getNomCat() }}</h6>
					</p>
				</div>
			</div>

			<div class="card mb-3">
				<div class="card-body">
					<h5 class="card-title text-primary">Titre</h5>
					<p class="card-text">
						<h6>{{ tache.getTitreT() }}</h6>
					</p>
				</div>
			</div>

			<div class="card mb-3">
				<div class="card-body">
					<h5 class="card-title text-primary">Date Debut</h5>
					<p class="card-text">
						<h6>{{ tache.getDateDT()|date('d-m-Y') }}</h6>
					</p>
				</div>
			</div>

			<div class="card mb-3">
				<div class="card-body">
					<h5 class="card-title text-primary">Date Fin</h5>
					<p class="card-text">
						<h6>{{ tache.getDateFT()|date('d-m-Y') }}</h6>
					</p>
				</div>
			</div>

			<div class="card mb-3">
				<div class="card-body">
					<h5 class="card-title text-primary">Description</h5>
					<div class="row mb-3">
						<div class="col-sm-10">
							<h6><textarea class="form-control" style="height: 100px" readonly>{{ tache.getDescT() }}</textarea></h6>
						</div>
					</div>
				</div>
			</div>

			<div class="card mb-3">
				<div class="card-body">
					<h5 class="card-title text-primary">Etat</h5>
					<p class="card-text">
						<h6>{{ tache.getEtatT() }}</h6>
					</p>
				</div>
			</div>


			<!-- Comment Section -->
			
			<div class="card mb-3">
				<div class="card-body">
					
					<div class="comment-section">
						<h5 class="card-title text-primary">Commentaires</h5>
						{% if tache.getCommentaireTache() is not empty %}
						{% for commentaire in tache.getCommentaireTache() %}
						<div class="comment">
							<div>
								<h6>Nom: {{ commentaire.getIdUser().getNomUser() }} | Date: {{ commentaire.getDateC()|date('d-m-Y') }}</h6>
								<!-- Add Edit and Remove Options for the Comment -->
							{% if userId == commentaire.getIdUser().getIdUser() %}
							<div class="comment-options">
								<button onclick="location.href='{{ path('commentairetache_update', {'i': commentaire.getIdC()}) }}'" type="button" class="btn btn-outline-primary"><i class="bi bi-pencil"></i> Modifier</button>
								<button onclick="location.href='{{ path('commentairetache_delete', {'i': commentaire.getIdC()}) }}'" type="button" class="btn btn-danger"><i class="bi bi-trash"></i> Supprimer</button>
							</div>
							{% endif %}
							</div>
							<h6><textarea class="form-control" style="height: 150px" readonly>{{ commentaire.getTexteC() }}</textarea></h6>
							
							
						</div>
						{% endfor %}
						{% endif %}
					</div>
				

				</div>
				<div class="container mt-4">
					<!-- Add Comment Form -->
					<hr>
					<h5 class="card-title text-primary">Ajouter un commentaire</h5>

					{{ form_start(commentForm, {'attr': {'class': 'row g-3', 'novalidate': 'novalidate'}}) }}
					
						{{ form_widget(commentForm.texte_C, { 'attr': {'class': 'form-control', 'style': 'height: 150px'} }) }}
						{% if commentForm.texte_C.vars.errors|length > 0 %}
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							<i class="bi bi-exclamation-octagon me-1"></i>
							{% for error in commentForm.texte_C.vars.errors %}
							{{ error.message }}
							{% endfor %}
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
						{% endif %}
					
					<div class="text-center">
						{{ form_widget(commentForm.Save, { 'attr': {'class': 'btn btn-outline-primary'}, 'label': 'Save' }) }}
						{{ form_widget(commentForm.Reset, { 'attr': {'class': 'btn btn-secondary'}, 'label': 'Reset' }) }}
					</div>
					{{ form_end(commentForm) }}
				</div>
			</div>

			<div class="col-md-4" style="margin-top: 10px;">
				<!-- Adjust margin-top as needed -->
				<button onclick="goBack()" class="btn btn-outline-primary"><i class="bi bi-arrow-left"></i> Go Back</button>
				<script>
					function goBack() {
						window.history.back();
					}
				</script>
			</div>

		</div>

		<div class="col-md-6">
			<div class="card shadow-sm">
				{% if tache.getPieceJointeT() %}
				{% set fileExtension = tache.getPieceJointeT()|split('.')|last %}
				{% if fileExtension in ['jpg', 'jpeg', 'png', 'gif'] %}
				<img src="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}" class="card-img-top" alt="Piece jointe">
				<div class="card-body">
					<p class="card-text text-muted mt-3">
						Télécharger la pièce jointe : <a href="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}">{{ tache.getPieceJointeT() }}</a>
					</p>
				</div>
				{% elseif fileExtension == 'pdf' %}
				{% set pdfPreviewPath = asset('uploads/' ~ tache.getPieceJointeT()) %}
				<embed src="{{ pdfPreviewPath }}" type="application/pdf" width="100%" height="500px" />
			<div class="card-body">
				<p class="card-text text-muted mt-3">
					Télécharger la pièce jointe : <a href="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}">{{ tache.getPieceJointeT() }}</a>
				</p>
			</div>
			{% elseif fileExtension == 'txt' %}
			<div class="card-body">
				<h5 class="card-title text-primary">{{ tache.getPieceJointeT() }} :</h5>
			</div>
			{% set textFilePath = asset('uploads/' ~ tache.getPieceJointeT()) %}
			<iframe src="{{ textFilePath }}" class="card-text" style="width: 100%; min-height: 300px;"></iframe>
			<div class="card-body">
				<p class="card-text text-muted mt-3">
					Télécharger la pièce jointe : <a href="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}">{{ tache.getPieceJointeT() }}</a>
				</p>
			</div>
			{% else %}
			<div class="card-body">
				<p class="card-text text-muted mt-3">
					Télécharger la pièce jointe : <a href="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}">{{ tache.getPieceJointeT() }}</a>
				</p>
			</div>
			{% endif %}
			{% else %}
			<div class="card-body">
				<p class="card-text text-muted mt-3">
					Aucune pièce jointe pour cette tâche.
				</p>
			</div>
			{% endif %}
		</div>
	</div>


</div>
</div>
{% endblock %}
{%block rest%}{% endblock %}
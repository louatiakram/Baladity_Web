{% extends 'base-back.html.twig' %}

{% block title %}Détails de la Tâche{% endblock %}

{% block TacheNavState %}
<a class="nav-link" data-bs-target="#GestionTache-nav" data-bs-toggle="collapse" href="#" aria-expanded="true">
	{% endblock %}

	{% block TacheContentState %}
	<ul id="GestionTache-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
		{% endblock %}

		{% block ListeTacheNav %}<a href="{{ path('tache_list') }}" class="active"><i class="bi bi-circle"></i><span>Detail Tache</span></a>{% endblock %}


		{% block body %}
		<div class="container mt-4">
			<div class="row">
				<div class="col-md-6">
					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title text-primary">Catégorie</h5>
							<p class="card-text">
								{{ tache.getNomCat() }}
							</p>
						</div>
					</div>

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title text-primary">Titre</h5>
							<p class="card-text">
								{{ tache.getTitreT() }}
							</p>
						</div>
					</div>

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title text-primary">Date Debut</h5>
							<p class="card-text">
								{{ tache.getDateDT()|date('d-m-Y') }}
							</p>
						</div>
					</div>

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title text-primary">Date Fin</h5>
							<p class="card-text">
								{{ tache.getDateFT()|date('d-m-Y') }}
							</p>
						</div>
					</div>

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title text-primary">Description</h5>
							<div class="row mb-3">
								<div class="col-sm-10">
									<textarea class="form-control" style="height: 100px" readonly>{{ tache.getDescT() }}</textarea>
								</div>
							</div>
						</div>
					</div>

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title text-primary">Etat</h5>
							<p class="card-text">
								{{ tache.getEtatT() }}
							</p>
						</div>
					</div>


					<!-- Comment Section -->
<div class="card mb-3">
    <div class="card-body">
        <div class="comment-section">
            <h5 class="card-title text-primary">Commentaire</h5>
            {% if tache.getCommentaireTache() is not null %}
    <div class="comment">
        <p>{{ tache.getCommentaireTache().getTexteC() }}</p>
        <p>Date: {{ tache.getCommentaireTache().getDateC()|date('d-m-Y') }}</p>
        <!-- Add Edit and Remove Options for the Comment -->
        <div class="comment-options">
            <button onclick="location.href='{{ path('commentairetache_update', {'i': tache.getCommentaireTache().getIdC()}) }}'" type="button" class="btn btn-outline-primary"><i class="bi bi-pencil"></i> Modifier</button>
            <button onclick="location.href='{{ path('commentairetache_delete', {'i': tache.getCommentaireTache().getIdC()}) }}'" type="button" class="btn btn-danger"><i class="bi bi-trash"></i> Supprimer</button>
        </div>
    </div>
{% else %}
    <!-- Add button to add comment if there is no comment -->

    <a href="{{ path('commentairetache_add', {'id': tache.getIdT()}) }}" class="btn btn-primary"><i class="bi bi-plus"></i> Ajouter un commentaire</a>
{% endif %}
        </div>
    </div>
</div>
<div class="col-md-4" style="margin-top: 10px;"> <!-- Adjust margin-top as needed -->
	<button onclick="goBack()" class="btn btn-outline-primary"><i class="bi bi-arrow-left"></i> Go Back</button>
	<script>
		function goBack() {
			window.history.back();
		}
	</script>
</div>

				</div>

				<div class="col-md-6">
					<div class="card shadow-sm">
						{% if tache.getPieceJointeT() %}
						{% set fileExtension = tache.getPieceJointeT()|split('.')|last %}
						{% if fileExtension in ['jpg', 'jpeg', 'png', 'gif'] %}
						<img src="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}" class="card-img-top" alt="Piece jointe">
						{% elseif fileExtension == 'pdf' %}
						{% set pdfPreviewPath = asset('uploads/' ~ tache.getPieceJointeT()) %}
						<embed src="{{ pdfPreviewPath }}" type="application/pdf" width="100%" height="500px" />
					{% else %}
					<div class="card-body">
						<p class="card-text text-muted mt-3">
							Télécharger la pièce jointe : <a href="{{ asset('uploads/' ~ tache.getPieceJointeT()) }}">{{ tache.getPieceJointeT() }}</a>
						</p>
					</div>
					{% endif %}
					{% else %}
					<div class="card-body">
						<p class="card-text text-muted mt-3">
							Aucune pièce jointe pour cette tâche.
						</p>
					</div>
					{% endif %}
				</div>
			</div>


		</div>
	</div>
	{% endblock %}